<!-- Search Bar -->
<div class="menu-item">
  <div class="arrow"></div>
  <h2 class="title">Users ({{numberofusers}})</h2>
  <div class="search-bar">
  <mat-form-field appearance="fill" class="search-field">
    <mat-label > Search by Te identifier</mat-label>
    <input  matInput [(ngModel)]="searchTerm" name="user.userName" placeholder="Te identifier">
  </mat-form-field>
</div>

<div id="table" class="mat-elevation-z8">

<div class="card">
  <p-table
      [value]="(users | userFilter:searchTerm) || []"
      [paginator]="true"
      [rows]="5"
      [tableStyle]="{ 'min-width': '50rem' }"
      [rowsPerPageOptions]="[5, 10, 20]"
  >
      <ng-template pTemplate="header">
          <tr>
              <th style="width:25%;"># Te identifier</th>
              <th style="width:25%">Fullname</th>
              <th style="width:25%">Email </th>
              <th style="width:25%">Roles </th>
              <th style="width:25%"> Location </th>
              <th style="width:25%">Plant </th>
              <th style="width:25%">Departement </th>
              <th style="width:25%">Backup Aprover </th>
              <th style="width:25%">Actions </th>

          </tr>
      </ng-template>
      <ng-template pTemplate="body" let-user>
          <tr>
              <td>{{user.userName}}</td>
              <td> {{user.teNum}} </td>
              <td>{{user.email}}</td>
              <td><div *ngFor="let role of user.roles">
                {{role}}
              </div></td>
              <td>{{user.location}} </td>
              <td>{{user.plant_name}}</td>
              <td>{{user.departmentName}}</td>
              <td>{{user.backupaprover_Name}} </td>
              <td> <!-- Actions Button -->
                <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Actions">
                  <mat-icon>more_vert</mat-icon>
                </button>
            
                <mat-menu #menu="matMenu">
                  <!-- View Details Button -->
                  <button mat-menu-item (click)="viewUserDetails(user)">
                    <mat-icon>visibility</mat-icon>
                    <span>View Details</span>
                  </button>
                  <!-- Update Button -->
                  <button mat-menu-item (click)="openUpdateModal(user)">
                    <mat-icon>edit</mat-icon>
                    <span>Update</span>
                  </button>
                  <!-- Delete Button -->
                  <button mat-menu-item (click)="deleteUser(user)">
                    <mat-icon>delete</mat-icon>
                    <span>Delete</span>
                  </button>
                  <!-- Change Password Button -->
                  <button mat-menu-item (click)="openChangePasswordModal(user.id)">
                    <mat-icon>vpn_key</mat-icon>
                    <span>Change Password</span>
                  </button>
                </mat-menu></td>
             
          </tr>
      </ng-template>
  </p-table>
</div>
</div>

<p-toast></p-toast>
<!-- modal to hundel the update and the showdeails of the user -->
<app-user-modal *ngIf="showModal"
                [user]="selectedUser"
                [userId]="userId"
                [mode]="modalMode"
                (closeModal)="closeModal()"
                (updateUser)="updateUser($event)"
                (changePassword)="changePassword($event)">
</app-user-modal> </div> 